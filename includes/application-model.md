---
ms.openlocfilehash: efa18cbe9e825b5ade045f37b1612457ba2c1b46
ms.sourcegitcommit: bab1265d669c3e6871daa7cb8a5640a47104947a
translationtype: MT
---
# 计算

Azure 使您能够部署和监视应用程序代码运行在微软数据中心内。 当您创建的应用程序，在 Azure 上运行它，代码和配置在一起称为 Azure 托管服务。 托管的服务很容易管理、 向上和向下扩展、 重新配置和与您的应用程序代码的新版本更新。 本文主要介绍承载 Azure 服务应用程序模型。<a id="compare" name="compare"></a>

## 目录<a id="_GoBack" name="_GoBack"></a>

-   [Azure 应用程序模型的好处][]
-   [托管的服务的核心概念][]
-   [托管的服务设计考虑事项][]
-   [设计应用程序的规模][]
-   [托管的服务定义和配置][]
-   [服务定义文件][]
-   [服务配置文件][]
-   [创建和部署托管的服务][]
-   [参考][]

## <a id="benefits"> </a>Azure 应用程序模型的好处

在部署您的应用程序作为托管服务时，Azure 创建一个或多个虚拟机 (Vm) 包含应用程序的代码，并驻留在一个 Azure 数据中心中的物理计算机上启动虚拟机。 向宿主应用程序的客户端请求中输入的数据中心，负载平衡器分布平均分摊到 Vm 这些请求。 虽然 Azure 中承载了应用程序，它获取三个主要好处︰

-   **高可用性。** 高可用性是指 Azure 可以确保您的应用程序正在运行尽可能多地并且能够响应客户端请求。 如果您的应用程序终止 （由于未处理的异常，例如），然后 Azure 将检测到此，它将自动地重新启动您的应用程序。 如果计算机运行应用程序体验某种类型的硬件故障，Azure 将还进行检测和自动在另一个工作的物理计算机上创建新的虚拟机然后从那里运行您的代码。 注意︰ 为了使您的应用程序获取的 99.95%可用的 Microsoft 的服务级别协议，您必须至少两个虚拟机运行在应用程序代码。 这样一个虚拟机来处理客户端请求，而 Azure 将代码从一个失败的虚拟机移动到一个新的、 好的虚拟机。

-   **可缩放性。** Azure 使您可以轻松地和动态更改运行应用程序代码中的虚拟机来处理实际的负载被放置在您的应用程序数。 这使您可以调整您的应用程序的工作负荷，您的客户要在其上放置时仅为虚拟机可以在需要时，您需要支付。 当您想要更改的虚拟机数量时，Azure 的响应在几分钟之内可以动态地更改根据需要随时运行的虚拟机的数量。

-   **可管理性。** 由于 Azure 平台即服务 (PaaS) 提供，它管理的基础结构 （硬件本身、 电力和网络） 要求保留这些机器运行。 Azure 还管理平台，确保与所有正确的修补程序和安全更新，以及例如.NET Framework 和 Internet 信息服务器组件更新最新的操作系统。 因为所有的虚拟机运行的 Windows Server 2008，Azure 提供了附加功能，如和诊断性监视、 桌面的远程支持、 防火墙和证书存储区配置。 所有这些功能都没有提供额外的成本。 事实上，在 Azure 中运行应用程序时，Windows Server 2008 操作系统 (OS) 许可证是包括在内。 因为所有的虚拟机运行的 Windows Server 2008，Windows Server 2008 运行的任何代码正常工作只在 Azure 中运行时。

## <a id="concepts"> </a>托管的服务的核心概念

作为在 Azure 托管服务部署应用程序时，运行作为一个或多个*角色。* *角色*只是指应用程序文件和配置。 对于您的应用程序，每一个都有其自己的应用程序文件和配置集，您可以定义一个或多个角色。 对于您的应用程序中每个角色，可以指定数量的虚拟机或*角色实例*，运行。 下图显示两个简单的示例应用程序作为托管服务使用角色和角色实例建模。

##### 图 1︰ 一个角色与 Azure 数据中心中运行的三个实例 (Vm)

![image][0]

##### 图 2︰ 两个角色，每个都有两个实例 (Vm)，Azure 数据中心中运行

![image][1]

角色实例通常处理互联网进入数据中心通过所谓*输入终结点*的客户端请求。 一个角色可以有 0 个或更多输入终结点。 每个终结点表示一种协议 （HTTP、 HTTPS 或 TCP） 和端口。 常见的配置角色具有两个输入终结点︰ HTTP 侦听端口 80 和 HTTPS 端口 443 上侦听。 下图显示两个不同角色的示例与定向到它们的客户端请求的不同输入终结点。

![image][2]

在 Azure 创建托管的服务时，其分配公开寻址的 IP 地址，客户端可以用来对其进行访问。 创建托管的服务时，还必须选择 URL 前缀映射到该 IP 地址。 此前缀必须是唯一的与实质上会保留*前缀*。 cloudapp.net URL，所以没有其他人可以拥有它。 客户端使用的 URL 与角色实例进行通信。 通常情况下，将未分发或发布 Azure*前缀*。 cloudapp.net URL。 相反，将购买选择的 DNS 注册 DNS 名称和配置您的 DNS 名称，将客户端请求重定向到 Azure 的 URL。 有关详细信息，请参阅[配置 Azure 中的自定义域名][]。

## <a id="considerations"> </a>托管的服务设计考虑事项

在设计时在云环境中运行的应用程序，有几个因素，需要考虑如延迟、 高可用性和可伸缩性。

决定应用程序代码中的位置是重要的考虑因素，Azure 中运行托管的服务时。 它是通常部署在应用程序与数据中心靠近您的客户端，以减少等待时间并获得可能的最佳性能。
但是，如果您有关于您的数据的一些 jurisdictional 或法律问题和其所在可以选择更接近于您的公司或更接近于您的数据的数据中心。 能够在承载您的应用程序代码是在全球范围内的六个数据中心。 下表显示了可用的位置︰

<table border="2" cellspacing="0" cellpadding="5" style="border: 2px solid #000000;">
<tbody>
<tr>
<td style="width: 100px;">
**国家/地区**

</td>
<td style="width: 200px;">
**子区域**

</td>
</tr>
<tr>
<td>
美国

</td>
<td>
中南部和中北部

</td>
</tr>
<tr>
<td>
欧洲

</td>
<td>
北部和西部

</td>
</tr>
<tr>
<td>
亚洲

</td>
<td>
东南亚和东亚

</td>
</tr>
</tbody>
</table>
在创建托管的服务时，您选择子区域，指示要在其中执行代码的位置。

为了实现高可用性和可扩展性，它是至关重要的应用程序的数据保存在一个中央存储库，可供多个角色实例访问。 为了做到这一点，Azure 提供如 blob、 表和 SQL 数据库的多个存储选项。 请参阅有关这些存储技术[在 Azure 中的数据存储产品][]文章。 下图显示了如何在 Azure 数据中心的负载平衡器分发给不同的角色实例都有权访问相同的数据存储的客户端请求。

![image][3]

通常情况下，想要在同一个数据中心中找到应用程序代码和数据，因为这允许低滞后时间 （更好的性能） 时，应用程序代码中访问数据。 此外，您将不收取带宽时在同一个数据中心内移动数据。

## <a id="scale"> </a>设计应用程序的规模

有时，您可能希望采取单个应用程序 （如一个简单的网站），并让它在 Azure 中承载。 但通常情况下，您的应用程序可能包含几个角色的所有一起工作。 例如，在下图中，有两个网站的角色、 订单处理角色，该角色的三个实例和报表生成器角色的一个实例。 这些角色都在正常工作在一起，为所有这些代码可以打包在一起并部署作为一个整体到 Azure。

![image][4]

拆分应用程序分成不同的角色，每个都运行在它自己的角色实例 (即，Vm) 集上的主要原因是独立扩展角色。 例如，在节日期间许多客户可能会购买的产品从您的公司，因此您可能想要将角色实例运行您网站的角色，以及运行订单处理角色角色实例数数增加。 在节日后可能会大量的产品，因此可能仍然需要大量的网站实例但较少的订单处理实例。 在剩下的一年中，可能只需要几个网站和订单处理的实例。 在所有这些阶段，您可能需要只有一个报表生成器实例。 在 Azure 中基于角色的部署的灵活性使您可以轻松地调整应用程序与您的业务需求。

它是通常有内托管的服务实例之间的互相的作用。 例如，网站角色接受客户订单，但然后可以转移到订单处理服务器角色实例实例处理的顺序。 通过一套到另一组实例角色实例正在使用提供的 Azure，队列技术工作窗体的最佳办法的队列服务或服务总线队列。 队列的使用是情景的这里的一个关键部分。 该队列允许托管的服务，以扩展其角色独立从而可以平衡工作负荷与成本。 如果队列中的消息数增加，随着时间的推移，然后可以扩大订单处理角色实例数。 如果队列中的消息数减少随着时间的推移，然后可以缩小订单处理角色实例数。 这种方式，您都只支付处理的实际工作负荷所需的实例。

队列还提供了可靠性。 当缩放比例下的顺序处理角色实例数，Azure 决定要终止的实例。 它可能会决定终止正在处理队列消息的实例。 但是，由于未成功完成的消息处理，消息成为再次看到另一个订单处理角色实例来取走并处理它。 由于队列消息可见性，保证消息最终获得处理。 队列还通过有效地分发到请求消息的从它的所有角色实例消息作为负载平衡器。

对于网站角色实例中，您可以监视进入它们的通信并决定扩展它们的数量上移或下移也。 队列可以扩展独立于订单处理角色实例网站角色实例数。 这是非常强大，并为您提供了很大的灵活性。 当然，如果您的应用程序包含的其他角色，您可以添加附加队列它们，以便利用相同的刻度和成本效益之间通信的管道。

## <a id="defandcfg"> </a>托管的服务定义和配置

部署到 Azure 托管的服务要求您还有服务定义文件和服务配置文件。 这两个文件是 XML 文件，并允许您以声明方式指定的托管的服务部署选项。 服务定义文件描述的所有角色构成您托管的服务和通信方式。 服务配置文件描述了每个角色和设置用来配置每个角色的实例的实例数。

## <a id="def"> </a>服务定义文件

如前所述，服务定义 (CSDEF) 文件是 XML 文件，描述了构成完整应用程序的各种角色。 完整的架构的 XML 文件可以在以下位置找到: [http://msdn.microsoft.com/library/windowsazure/ee758711.aspx] []。
CSDEF 文件中包含要在应用程序中每个角色的 WebRole 或 WorkerRole 元素。 部署角色作为 web 角色 （使用 WebRole 元素） 表示的代码将运行在包含 Windows Server 2008 和互联网信息服务器 (IIS) 的角色实例。
随着工作者角色 （使用 WorkerRole 元素） 意味着角色实例都将有 Windows Server 2008，在其上部署角色 （IIS 将不会安装）。

当然也可以创建和部署使用其他一些机制来侦听传入的 web 请求辅助角色 （例如，您的代码可以创建并使用.NET HttpListener）。 由于角色实例正在运行 Windows Server 2008，您的代码可以执行在 Windows 服务器上运行的应用程序通常可用的任何操作
2008.

对于每个角色，您可以指示应使用该角色的实例所需的虚拟机大小。 下表显示目前可用的各种虚拟机大小和每个属性︰

<table border="2" cellspacing="0" cellpadding="5" style="border: 2px solid #000000;">
<tbody>
<tr align="left" valign="top">
<td>
**虚拟机大小**

</td>
<td>
**CPU**

</td>
<td>
**RAM**

</td>
<td>
**磁盘**

</td>
<td>
**最佳网络输入/输出**

</td>
</tr>
<tr align="left" valign="top">
<td>
**额外的小**

</td>
<td>
1 x 1.0 g h z

</td>
<td>
768 MB

</td>
<td>
20 GB

</td>
<td>
\~5 Mbps

</td>
</tr>
<tr align="left" valign="top">
<td>
**Small**

</td>
<td>
1 x 1.6 g h z

</td>
<td>
1.75 GB

</td>
<td>
225 GB

</td>
<td>
\~100 Mbps

</td>
</tr>
<tr align="left" valign="top">
<td>
**Medium**

</td>
<td>
2 x 1.6 g h z

</td>
<td>
3.5 GB

</td>
<td>
490 GB

</td>
<td>
\~200 Mbps

</td>
</tr>
<tr align="left" valign="top">
<td>
**Large**

</td>
<td>
4 x 1.6 g h z

</td>
<td>
7 GB

</td>
<td>
1 TB

</td>
<td>
\~400 Mbps

</td>
</tr>
<tr align="left" valign="top">
<td>
**特大**

</td>
<td>
8 x 1.6 g h z

</td>
<td>
14 GB

</td>
<td>
2 TB

</td>
<td>
\~800 Mbps

</td>
</tr>
</tbody>
</table>
您将收取每小时每个虚拟机用作角色实例，并且您还收取任何数据，角色实例发送数据中心之外。 您不被收取数据进入数据中心。 有关详细信息，请参阅 [Azure 定价] []。 一般情况下，最好使用许多小角色实例，而不是少数大情况下，使您的应用程序故障更具弹性。 毕竟，有角色实例更少、 更灾难性故障，其中一个是对总体应用程序。 此外，如前所述，必须为了获取 Microsoft 提供的 99.95%服务级别协议部署至少两个实例，每个角色。

您将在您的应用程序中指定每个角色的很多特性，也是服务定义 (CSDEF) 文件。 下面是一些更有用的项目可用的︰

-   **证书**。 可以使用证书加密数据或您的 web 服务是否支持 SSL。 任何证书需要上载到 Azure。 有关详细信息，请参阅[管理 Azure 中的证书][]。 此 XML 设置角色实例的证书存储区安装之前上载证书，以便它们可由应用程序代码中使用。

-   **配置设置的名称**。 您希望您的应用程序角色实例在运行时读取的值。 实际值的配置设置而无需重新部署您的代码更新任何时候服务 (CSCFG) 配置文件中设置。 事实上，您可以编写代码您的应用程序的方式来检测更改的配置值，而不会带来任何的停机时间。

-   **输入终结点**。 您在此处指定 （带有端口） 您想要向您的*前缀*通过外界公开任何 HTTP、 HTTPS 或 TCP 端点。 cloadapp.net URL。 Azure 部署您的角色时，它将自动在角色实例上配置防火墙。

-   **内部的终结点**。 您在此处指定任何 HTTP 或 TCP 公开的终结点所需部署作为应用程序一部分的其他角色实例。 内部端点允许在您的应用程序互相通信的所有角色实例，但将无法访问您的应用程序之外的任何角色实例。

-   **导入模块**。 这些选择角色实例上安装了一些有用的组件。 对于诊断监视，远程桌面和 Azure 连接 （它允许您通过安全通道访问内部资源的角色实例） 存在的组件。

-   **本地存储区**。 分配应用程序要使用的角色实例上的子目录。 [数据存储产品和服务在 Azure][]文章中更详细地描述它。

-   **启动任务**。 启动任务使您可以在角色实例上安装系统必备组件，如其启动方式。 任务可以运行作为管理员如果需要提升。

## <a id="cfg"> </a>服务配置文件

服务配置 (CSCFG) 文件是 XML 文件，描述可以进行更改而不重新部署您的应用程序的设置。 完整的架构的 XML 文件可以在以下位置找到︰ [http://msdn.microsoft.com/library/windowsazure/ee758710.aspx][]。
CSCFG 文件中包含多个应用程序中每个角色的角色元素。 以下是一些可以在 CSCFG 文件中指定的项目︰

-   **操作系统的版本**。 此特性允许您选择要用于运行应用程序代码中的所有角色实例的操作系统 (OS) 版本。 此操作系统被称为*来宾操作系统*，和每个新版本包含最新的安全修补程序和更新在访客操作系统发布的时可用。 如果您将 osVersion 属性值设置为"\*"，然后 Azure 自动更新每个角色实例上的访客操作系统推出新来宾 OS 版本。 但是，您可以选择不自动更新通过选择特定的访客操作系统版本。 例如，将 osVersion 属性设置为的值为"WA 来宾 OS 2.8\_201109-01"导致所有角色的实例来获取此网页上的描述︰ [http://msdn.microsoft.com/library/hh560567.aspx][]。 来宾操作系统版本有关详细信息，请参阅[管理 Azure 来宾操作系统的升级]。

-   **实例**。 此元素的值表示所需提供运行代码的特定角色的角色实例数。 由于 （无需重新部署您的应用程序），可以将一个新的 CSCFG 文件上载到 Azure，因此，一般而言简单更改该元素的值和上传一个新的 CSCFG 文件来动态地增加或减少的角色运行应用程序代码中的实例数。 这使您可以方便地扩展您的应用程序向上或向下满足实际工作负荷的需要，同时也控制多少收取运行角色实例。

-   **配置设置值**。 此元素指示设置值 （在 CSDEF 文件中定义）。 您的角色可以在运行时读取这些值。 这些配置设置值通常用于连接字符串到 SQL 数据库或到 Azure 存储中，但是它们可以用于任何目的所需。

## <a id="hostedservices"> </a>创建和部署托管的服务

创建托管的服务需要先转到[Azure 管理门户]，通过指定 DNS 前缀提供托管的服务和数据中心最终需要运行的代码。 然后在您的开发环境，您可以创建服务定义 (CSDEF) 文件，生成到一个服务包 (CSPKG) 文件的应用程序代码和所有这些文件的包 (zip)。 您必须准备好服务配置 (CSCFG) 文件。 若要部署您的角色，您可以上载 Azure 服务管理 API 的 CSPKG 和 CSCFG 文件。 一旦部署，Azure，将设置角色实例中 （根据配置数据） 的数据中心，从包中提取您的应用程序代码、 将其复制到角色实例中，并启动实例。 现在，您的代码是启动和运行。

下图显示了您在您的开发计算机创建的 CSPKG 和 CSCFG 文件。 CSPKG 文件中包含的 CSDEF 文件，这两个角色的代码。 之后上传带有 Azure 服务管理 API 的 CSPKG 和 CSCFG 文件，Azure 数据中心中创建角色实例。 在此示例中，CSCFG 文件指示 Azure 应该创建角色的三个实例\#1 至两个角色的实例\#2。

![image][5]

有关部署的更多信息，升级和重新配置您的角色，请参阅[部署和更新 Azure 应用程序][]项目。<a id="Ref" name="Ref"></a>

## <a id="references"> </a>参考

-   [创建 Azure 托管的的服务][]

-   [管理 Azure 的托管的服务][]

-   [应用程序迁移到 Azure][]

-   [Azure 应用程序配置][]

<div style="width: 700px; border-top: solid; margin-top: 5px; padding-top: 5px; border-top-width: 1px;">

<p>编写的 Jeffrey Richter (Wintellect)</p>

</div>

  [Azure 应用程序模型的好处]: #benefits
  [托管的服务的核心概念]: #concepts
  [托管的服务设计考虑事项]: #considerations
  [设计应用程序的规模]: #scale
  [托管的服务定义和配置]: #defandcfg
  [服务定义文件]: #def
  [服务配置文件]: #cfg
  [创建和部署托管的服务]: #hostedservices
  [参考]: #references
  [0]: ./media/application-model/application-model-3.jpg
  [1]: ./media/application-model/application-model-4.jpg
  [2]: ./media/application-model/application-model-5.jpg
  [在 Azure 中配置自定义域名]: http://www.windowsazure.com/develop/net/common-tasks/custom-dns/
  [在 Azure 中的数据存储产品]: http://www.windowsazure.com/develop/net/fundamentals/cloud-storage/
  [3]: ./media/application-model/application-model-6.jpg
  [4]: ./media/application-model/application-model-7.jpg
  
  [Azure 的价格]: http://www.windowsazure.com/pricing/calculator/
  [管理 Azure 中的证书]: http://msdn.microsoft.com/library/windowsazure/gg981929.aspx
  [http://msdn.microsoft.com/library/windowsazure/ee758710.aspx]: http://msdn.microsoft.com/library/windowsazure/ee758710.aspx
  [http://msdn.microsoft.com/library/hh560567.aspx]: http://msdn.microsoft.com/library/hh560567.aspx
  [管理到 Azure 的来宾 OS 升级]: http://msdn.microsoft.com/library/ee924680.aspx
  [Azure 的管理门户]: http://manage.windowsazure.com/
  [5]: ./media/application-model/application-model-8.jpg
  [部署和更新 Azure 应用程序]: http://www.windowsazure.com/develop/net/fundamentals/deploying-applications/
  [创建 Azure 托管的的服务]: http://msdn.microsoft.com/library/gg432967.aspx
  [管理 Azure 的托管的服务]: http://msdn.microsoft.com/library/gg433038.aspx
  [应用程序迁移到 Azure]: http://msdn.microsoft.com/library/gg186051.aspx
  [Azure 应用程序配置]: http://msdn.microsoft.com/library/windowsazure/ee405486.aspx
