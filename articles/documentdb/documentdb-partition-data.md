---
ms.openlocfilehash: 6ab75f9cd46beba869fdf2746ad8833b74c26db5
ms.sourcegitcommit: bab1265d669c3e6871daa7cb8a5640a47104947a
translationtype: MT
---
<properties      
    pageTitle="在 DocumentDB 数据分区 |Microsoft Azure"      
    description="了解有关如何在 DocumentDB，和何时使用哈希、 广泛和查找分区数据分区。"          
    services="documentdb"      
    authors="arramac"      
    manager="jhubbard"      
    editor="monicar"      
    documentationCenter=""/> 
<tags      
    ms.service="documentdb"      
    ms.workload="data-services"      
    ms.tgt_pltfrm="na"      
    ms.devlang="na"      
    ms.topic="article"      
    ms.date="05/28/2015"      
    ms.author="arramac"/> 

# 在 DocumentDB 的数据分区

[Microsoft Azure DocumentDB](../../services/documentdb/)旨在帮助您实现快速、 可预知的性能，以及您的应用程序无缝地*向外扩展*，随着它的发展。 DocumentDB 用于电源在 Microsoft 等通电了 MSN 一套 web 和移动应用程序用户数据存储的高比例制作服务。 

您可以通过水平分区数据的概念通常被称为**分片**DocumentDB 应用程序实现近无限存储和吞吐量方面的比例。  DocumentDB 帐户可以缩放线性通过堆叠的单位成本也 **收藏集**。 如何才能最好地跨集合划分数据取决于您的数据格式和访问模式。 

阅读完本文后您将能够回答以下问题︰   

 - 什么是哈希、 广泛和查找分区？
 - 使用每个分区的方法，为什么？
 - 如何着手构建在 Azure DocumentDB 分区应用程序？

本文介绍了分片有关的一些概念。 如果你准备写代码使用 DocumentDB.NET SDK 该分区数据，看一下[DocumentDB.NET sdk 的分区数据](documentdb-sharding.md)。

## 集合 = 分区

我们深入了解有关数据分区技术之前，很重要一点是要理解什么是一个集合，它不是。 如您可能已经知道，集合是一个用于 JSON 文档。 DocumentDB 中的集合不是只是*逻辑*容器，而是还*物理*容器。 它们是存储的过程和触发器，以及查询和 CRUD 操作的入口点的事务边界。 每个集合分配吞吐量不会共享相同的帐户中的其他集合与这些保留的金额。 因此，可以将应用程序存储和吞吐量方面放大通过添加多个收藏集，然后将文档分发它们之间。

集合不是关系数据库中的表相同。 集合不会强制使用架构。 因此您可以在同一集合中存储不同类型的文档与不同的架构。 但是，可以使用集合来存储单一类型的表像的对象。 最佳的模型只取决于数据如何在一起出现在查询和交易。

## 与 DocumentDB 分区

用于使用 Azure DocumentDB 分区数据的最常见方法是*按范围分区*，*查阅分区*以及*哈希分区*。 通常您指定单个 JSON 属性名称在您的文档中"时间戳"或"用户 Id"等分区键。 在某些情况下，这可能是内部的 JSON 属性或文档的每种不同类型的不同属性名称。

让我们更详细地看一下这些技术。

## 范围分区

在按范围分区，分区分配基于分区键是否在某一范围内。 这通常用于分区的*时间戳*属性 (例如，eventTime 之间于 2015 年 2 月 1 日，并于 2015 年 2 月 2 日)。 

> [AZURE.TIP] 您应该使用范围分区，如果您的查询只限于特定范围针对分区键的值。

## 查找分区

在分区的查询中，基于也将离散的分区值分配给特定分区的查找映射分配分区 分区或 shard 的映射。 这通常用于按区域 （例如斯堪的纳维亚的分区包含挪威，丹麦，瑞典） 分区。

> [AZURE.TIP] 查找分区提供了管理多租户应用程序的控制程度最高。 跨多个集合，可以将多个租户分配给单个集合、 单个租户到一个集合中或甚至一个租户。 

## 哈希分区

在哈希分区，分区分配基于值的哈希函数，使您能够均匀地分布到请求和数据的分区数。 这通常用于数据生产或消耗从大量不同的客户端，并可用于存储用户配置文件、 目录项和 IoT （"Internet 的事物"） 遥测数据的分区。 

> [AZURE.TIP] 您应使用哈希分区时那里被过多的实体，以枚举通过查阅分区 （如用户或设备） 和请求速率是相当统一的实体。

## 选择正确的分区技术

那么哪些分区技术是最适合您？ 这取决于数据类型以及常见的访问模式。 领料在设计时分区技术的权利，可避免技术债务，和处理的数据大小和申请量的增长。

- **范围分区**通常用于上下文中的日期，因为它为您提供简单而自然出分区老化机制的时间戳。 当查询通常局限于某个时间范围内，与分区边界对齐，因为还有非常有用。 
- **查找分区**使您可以分组和组织无序和不相关的数据集在自然方式即通过组织组承租人或按地理区域表明。 搜索还提供细粒度控制迁移数据集合之间。 
- **哈希分区**可用于请求，从而能够有效地使用您的存储资源调配和吞吐量的统一的负载平衡。 使用*一致性哈希*算法使您可以添加或删除分区时需要移动的数据量最小。

您不必选择分区，只是一项技术。 *复合*的这些技术还可根据具体情况。 例如，如果您存储车辆遥测数据，一个好的方法应分区设备遥测数据按范围分区的易管理性的时间戳是然后子要向外扩展的吞吐量 （范围希复合分区） 进行分区在 VIN （车牌号） 上。

## 分区的应用程序开发
有三个主要设计方面，要看分区上开发应用程序 DocumentDB。

- 您如何传送您创建和读取 （包括查询） 的权限集合。
- 如何保存和检索您的分区解析配置，也 分区映射。
- 您如何添加或删除分区作为您的数据和请求量的增大。

让我们看一下其中每一个方面。

## 路由创建和查询

传送文档创建请求是非常简单的为我们前面讨论过的所有这三种技术。 从希、 查阅或范围值对应于分区键分区上创建文档。

查询和读取应通常仅限于单个分区键，使查询可以按扇形展开只匹配的分区。 对所有数据的查询但是，会要求您对*扇出*请求跨多个分区，然后合并结果。 请记住，某些查询可能必须执行自定义逻辑来合并如当取前 N 位产生的结果。

## 管理分区图

您还需要决定如何存储分区图，您的客户如何加载和接收更新何时更改，以及如何跨多个客户端共享。 如果不经常更改的分区映射，可以简单地将其保存在您应用程序配置文件。 

如果没有，您可以将其存储在任何持久存储区中。 我们发现，在生产中常见的设计模式是将分区映射序列化为 JSON，并将它们存储在 DocumentDB 收藏集内。 客户端可以然后以避免额外的往返行程中，缓存映射，然后定期轮询更改。 如果您的客户端可能会修改 shard 映射，请确保它们使用一致的命名方案，并使用开放式并发 (Etag) 允许分区图一致的更新。

## 添加和删除分区

使用 DocumentDB，可以添加和随时删除集合并使用这些存储区新传入的数据或重新平衡可用现有集合上的数据。 查看的收藏集数量的[限制](documentdb-limits.md)页面。 您始终可以调用我们可以增加这些限制。

添加和删除新的分区与查阅和范围分区非常简单。 例如，添加新的地理区域或新的时间范围为最新的数据，您只需将新分区添加到分区图。 拆分成多个分区，一个现有分区或合并两个分区需要稍微更多的努力。 您需要 

- 对读采取 shard 脱机。
- 这两个分区使用旧的分区配置，以及在迁移过程中新的分区配置为读取路由。 完成迁移之前，注意交易记录和一致性级别保证将不可用。

哈希是相对更复杂进行添加和删除分区。 简单的哈希技术将导致随机排布，并要求大部分要获取移动的数据。 使用**一致的散列算法**可以确保只有一小部分数据需要移动。

添加新的分区，而无需移动数据相对比较简单的办法是"溢出"到一个新的集合，数据，然后扇出请求跨旧的和新的集合。 但是，应仅在极少数情况下使用这种方法 （如溢出在高峰时间的工作负载，可以移动它之前暂时存放数据）。

## 下一步行动
在本文中，我们介绍了一些常用的技术上如何可以分区数据的 DocumentDB，以及何时使用哪项技术的组合。 

-   下一步，看一看如何可以分区数据分区解析程序使用 DocumentDB SDK 在此[文章](documentdb-sharding.md)。 
-   一种[支持的 Sdk](https://msdn.microsoft.com/library/azure/dn781482.aspx)下载
-   请与我们联系通过[MSDN 支持论坛](https://social.msdn.microsoft.com/forums/azure/home?forum=AzureDocumentDB)如果您有任何疑问。
   


 

测试
