---
ms.openlocfilehash: 2479b8a3176e3e2ee8a6d09b37ee66751065a9c2
ms.sourcegitcommit: bab1265d669c3e6871daa7cb8a5640a47104947a
translationtype: MT
---
<properties 
    pageTitle="验证您的应用程序与实时连接 (JavaScript)" 
    description="学习如何使用实时连接单个登录在 Azure 移动服务从 Windows 应用商店应用程序。" 
    services="mobile-services" 
    documentationCenter="windows" 
    authors="ggailey777" 
    manager="dwrede" 
    editor=""/>

<tags 
    ms.service="mobile-services" 
    ms.workload="mobile" 
    ms.tgt_pltfrm="mobile-windows-store" 
    ms.devlang="javascript" 
    ms.topic="article" 
    ms.date="08/08/2015" 
    ms.author="glenga"/>

# 验证您的 Windows 应用商店应用程序与客户端使用 Microsoft 帐户托管身份验证

[AZURE.INCLUDE [mobile-services-selector-single-signon](../../includes/mobile-services-selector-single-signon.md)]  

##概述
本主题演示如何在 Azure 移动服务从 Windows 应用商店应用程序的用户进行身份验证。  在本教程中，您添加到快速入门项目使用实时连接身份验证。 当通过实时连接的身份验证，成功登录的用户按名称受到欢迎并显示用户 ID 值。  

>[AZURE.NOTE]本教程演示如何使用管理客户端的身份验证和实时 SDK 的好处。 这使您可以更轻松地与您已登录的用户的身份验证的移动服务。 您还可以请求其他作用域以使您的应用程序来访问资源，如 OneDrive。 
>服务管理身份验证提供更加通用的经验，并支持多个身份验证提供程序。 有关管理服务身份验证的详细信息，请参阅主题[添加到您的应用程序的身份验证](mobile-services-windows-store-javascript-get-started-users.md)。

本教程要求如下︰

+ [对于 Windows live SDK]
+ Microsoft Visual Studio 2012 表达为 Windows 8 RC 或更高版本
+ 此外第一次必须完成本教程[将添加到现有应用程序的移动服务]。

##注册您的应用程序使用 Microsoft 帐户进行身份验证

若要能够对用户进行身份验证，您必须注册您的应用程序开发人员中心中的 Microsoft 科目。 然后，您必须与您的移动服务连接此登记。 请完成以下主题创建 Microsoft 帐户注册，并将其连接到您的移动服务中的步骤。

+ [注册您的应用程序使用 Microsoft 帐户登录](mobile-services-how-to-register-microsoft-authentication.md)

##<a name="permissions"></a>限制对已验证身份的用户的权限

接下来需要限制对资源，在这种情况下的*TodoItems*表格，以确保它只能访问已登录的用户访问。

[AZURE.INCLUDE [mobile-services-restrict-permissions-windows](../../includes/mobile-services-restrict-permissions-windows.md)]  

##<a name="add-authentication"></a>向应用程序添加验证

最后，您将添加实时 SDK 并使用它在您的应用程序中的用户进行身份验证。

1. 在**解决方案资源管理器**中右击解决方案，然后选择**管理 NuGet 程序包**。

2. 在左窗格中，选择**联机**类别， **LiveSDK**搜索，单击**安装** **Live SDK**包、 选择所有项目，然后接受许可协议。 

    这向解决方案中添加实时 SDK。

3. 打开 default.html 项目文件，然后添加以下`<script>`元素在`<head>`元素。 

        <script src="/js/wl.js"></script>

5. 在**应用程序中。OnActivated**方法重载，对**refreshTodoItems**方法的调用替换为以下代码︰ 
    
        // Set the mobileClient variable to client variable generated by the tooling.
        var mobileClient = <yourClient>;

        var session = null;
        var login = function () {
            return new WinJS.Promise(function (complete) {
                WL.login({ scope: "wl.basic" }).then(function (result) {
                    session = result.session;

                    WinJS.Promise.join([
                        WL.api({ path: "me", method: "GET" }),
                        mobileClient.login(result.session.authentication_token)
                    ]).done(function (results) {
                        // Build the welcome message from the Microsoft account info.
                        var profile = results[0];                            
                        var title = "Welcome " + profile.first_name + "!";
                        var message = "You are now logged in as: "
                            + mobileClient.currentUser.userId;
                        var dialog = new Windows.UI.Popups.MessageDialog(message, title);
                        dialog.showAsync().then(function () {
                            // Reload items from the mobile service.
                            refreshTodoItems();
                        }).done(complete);
                        
                    }, function (error) {

                    });
                }, function (error) {
                    session = null;
                    var dialog = new Windows.UI.Popups.MessageDialog("You must log in.", "Login Required");
                    dialog.showAsync().done(complete);
                });
            });
        }

        var authenticate = function () {
            // Block until sign-in is successful.
            login().then(function () {
                if (session === null) {
                    // Authentication failed, try again.
                    authenticate();
                }
            });
        }

        // Initialize the Live client.
        WL.init({
            redirect_uri: mobileClient.applicationUrl
        });

        // Start the sign-in process.
        authenticate();

    这初始化实时连接的客户端，将新的登录请求发送到 Microsoft 客户、 将返回身份验证令牌发送到移动服务，然后显示已登录的用户的信息。 

    >[AZURE.NOTE]理想情况下，您应该要求实时连接 authentiction 令牌或移动服务授权标记每次您的应用程序运行时。 不只是这是低效的您可以运行到使用率的相关问题应许多客户尝试同时启动您的应用程序。 更好的方法是缓存标记并第一次调用**LoginWithMicrosoftAccountAsync**之前使用的缓存的移动服务标记。 如何缓存此标记的示例，请参阅[开始使用身份验证](mobile-services-windows-store-javascript-get-started-users.md#tokens)。
    
7. 替换值`<yourClient>`在您连接到移动服务的项目时，添加的.js 文件中定义的变量的代码之上的第一行。
        
8. 按 F5 键运行应用程序并使用您的 Microsoft 帐户登录。 

    成功签署中后，应用程序应该运行错误，并应能为移动服务的查询，并对数据进行更新。

## <a name="next-steps"> </a>下一步行动

在下一步的教程中，[有脚本的授权用户]，将采用基于身份验证的用户的移动服务提供的用户 ID 值，并使用它来筛选移动服务返回的数据。 有关如何使用其他标识提供程序进行身份验证的信息，请参阅[开始使用身份验证]。

<!-- Anchors. -->
[注册您的应用程序进行身份验证和配置移动服务]: #register
[限制为经过身份验证的用户的表权限]: #permissions
[向应用程序添加验证]: #add-authentication
[下一步行动]:#next-steps

<!-- Images. -->

<!-- URLs. -->
[提交应用程序页]: http://go.microsoft.com/fwlink/p/?LinkID=266582
[我的应用程序]: http://go.microsoft.com/fwlink/p/?LinkId=262039
[对于 Windows live SDK]: http://go.microsoft.com/fwlink/p/?LinkId=262253
[添加到现有应用程序的移动服务]: mobile-services-windows-store-javascript-get-started-data.md
[开始使用身份验证]: mobile-services-windows-store-javascript-get-started-users.md
[授权用户使用的脚本]: ../mobile-services-windows-store-javascript-authorize-users-in-scripts.md

[Azure 的管理门户]: https://manage.windowsazure.com/
 