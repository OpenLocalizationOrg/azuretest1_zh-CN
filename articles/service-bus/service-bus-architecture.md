---
ms.openlocfilehash: cb85d68b8e46950def8216a6e20cfae444c51a81
ms.sourcegitcommit: bab1265d669c3e6871daa7cb8a5640a47104947a
translationtype: MT
---
<properties 
   pageTitle="服务总线体系结构"
   description="描述消息处理的 Azure 服务总线的体系结构。"
   services="service-bus"
   documentationCenter="na"
   authors="sethmanheim"
   manager="timlt"
   editor="tysonn" />
<tags 
   ms.service="service-bus"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="tbd"
   ms.date="07/24/2015"
   ms.author="sethm" />

# 服务总线体系结构

下一节介绍的消息处理的 Azure 服务总线的体系结构。

## 服务总线的比例单位

服务总线是按*比例单位*组织的。 刻度单位是部署的单元，包含所有必需的组件运行服务。 每个地区部署了一个或多个服务总线的比例单位。

服务总线命名空间映射到刻度单位。 刻度单位处理所有类型的服务总线实体︰ 继电器，中转消息实体 （队列、 主题、 订阅），并通知集线器。 服务总线刻度单位由以下组件组成︰

- **网关的节点集。** 网关节点传入的请求进行身份验证和处理中继请求。 网关的每个节点都有一个公用 IP 地址。

- **消息传递代理节点集。** 消息代理节点处理有关消息实体的请求。

- **通知节点集。** 通知节点发送推式通知所有已注册的设备。

- **一个网关存储区。** 在网关存储中存放此比例单元中定义的每个实体的数据。 网关存储在 SQL Azure 数据库来实现。

- **许多邮件存储区。** 邮件存储区保存所有队列、 主题和订阅此比例单元中定义的消息。 它还包含所有的订阅数据。 除非启用[分区消息实体](https://msdn.microsoft.com/library/azure/dn520246.aspx)，则队列或主题映射到一个邮件存储区。 订阅存储在为其父主题相同的邮件存储区中。 在 SQL Azure 数据库实现了邮件存储区。

- **多个注册存储。** 注册存储包含此扩展单元中定义的所有通知集线器的设备登记。 注册存储是在 SQL Azure 数据库实现的。

## 容器

每个消息的实体分配特定的容器。 容器是一个使用一个消息存储区来存储此容器的所有相关数据的逻辑结构。 每个容器被分配给一个消息代理节点。 通常情况下，有更多比消息传递代理节点的容器。 因此，每个消息代理节点加载多个容器。 这样同样加载所有消息代理节点组织为消息代理节点的容器的分布。 如果负载模式更改 （例如，其中一个容器获取很忙），或如果消息代理节点将暂时不可用，容器会在消息代理节点之间重新分配。

## 处理传入消息的请求

当客户端将请求发送到服务总线时，Azure 负载平衡器将它路由到任何网关的节点。 网关节点可授权请求。 如果该请求涉及消息的实体 （队列、 主题、 订阅），网关节点网关存储区中的实体并确定哪些邮件存储区中的实体是所在。 它然后查找哪个消息代理节点当前正在处理此容器中，并将请求发送到该消息代理节点。 消息代理节点处理该请求并更新容器存储区中的实体状态。 消息代理节点然后发送响应返回给网关节点，将发送回客户端发出的原始请求的相应的响应。

![处理传入消息的请求](./media/service-bus-architecture/IC690644.png)

## 处理传入的中继请求

当客户端将请求发送到服务总线时，Azure 负载平衡器将它路由到任何网关的节点。 如果请求是侦听请求，网关节点创建新的中继。 如果请求为特定中继连接请求，网关节点转发连接请求发送到拥有中继网关节点。 拥有中继网关节点发送一个集合请求侦听客户端，询问该侦听器来创建网关节点接收的连接请求的临时通道。

当建立中继连接时，客户端可以交换通过用于集合的网关节点的消息。

![处理传入的中继请求](./media/service-bus-architecture/IC690645.png)

## 处理传入通知中心请求

当客户端将请求发送到服务总线时，Azure 负载平衡器将它路由到任何网关的节点。 如果请求是一个现有的通知集线器的设备登记，网关节点写入注册存储注册并向调用设备发送回复。 如果请求是一条通知消息，网关节点排队至通知队列中的消息。 通知节点之一取消排队的通知队列中的消息并将消息发送到注册存储中注册的所有设备。 如果邮件是由大量的设备接收，通知的多个节点加入将消息发送到设备。

![处理传入通知中心请求](./media/service-bus-architecture/IC690646.png)

## 下一步行动

现在，您已经阅读概述服务总线的工作原理，才能启动的访问以下链接︰

- [服务总线消息概述](service-bus-messaging-overview.md)
- [服务总线基础知识](service-bus-fundamentals-hybrid-solutions.md)
- [使用服务总线队列的排队消息传递解决方案](service-bus-dotnet-multi-tier-app-using-service-bus-queues.md)
