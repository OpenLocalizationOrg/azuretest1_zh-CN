---
ms.openlocfilehash: ce4cf271c82518c251c2c05da6e73768c13e8236
ms.sourcegitcommit: bab1265d669c3e6871daa7cb8a5640a47104947a
translationtype: MT
---
<properties 
   pageTitle="监视的通信流管理器"
   description="这篇文章将帮助 undertstand 并配置通信管理器监视"
   services="traffic-manager"
   documentationCenter=""
   authors="joaoma"
   manager="adinah"
   editor="tysonn" />
<tags 
   ms.service="traffic-manager"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="08/19/2015"
   ms.author="joaoma" />

# 有关通信量管理器监视

Azure 的流量管理器监视您包括云服务和网站，以确保它们是可用的终结点。 为了监视正常工作，您必须将其设置为每个终结点的通信管理器配置文件中指定相同的方式。 配置监视后，流量管理器将管理门户中显示您的终结点和配置文件的状态。 您的流量管理器配置文件，您可以在管理门户配置页面上配置监视设置。 您可以指定以下设置︰

- **协议**– 选择 HTTP 或 HTTPS。 请务必注意，HTTPS 监视不验证 SSL 证书是否有效，它只会检查该证书是否存在。

- **端口**— 选择请求使用此端口。 标准的 HTTP 和 HTTPS 端口是选项之一。

- **相对路径和文件名称**– 提供的路径和监视系统将尝试访问该文件的名称。 请注意，使用正斜杠"/"是相对路径的有效条目，表示该文件位于根目录下 （默认值）。 

## 有关监视运行状况

Azure 通信管理器管理门户中显示配置文件和终结点的服务运行状况。 配置文件和终结点的状态列显示最新的监视状态。 可以使用此状态以了解根据流量管理器监视设置您的配置文件的运行状况。 健康档案文件时，将基于配置文件 （循环、 性能或故障转移） 的流量路由设置服务分配 DNS 查询。 一旦监控系统通信管理器监视状态中检测到更改，它将更新管理门户中的状态项。 可能需要刷新的状态更改为最多五分钟。

### 终结点监视状态

下表中的终结点监视器状态是组合的终结点健康探测结果与您的配置文件和终结点配置的结果。

|配置文件状态|终结点状态|终结点监视状态 （API 和门户网站）|注释|
|---|---|---|---|
|禁用|已启用|处于非活动状态|禁用配置文件将不受监视。 但是，仍可以管理已禁用配置文件内的端点状态。|
|&lt;任何&gt;|禁用|禁用|禁用配置文件将不受监视。 但是，仍可以管理已禁用配置文件内的端点状态。|
|已启用|已启用|联机|终结点进行监控，并处于正常状态。|
|已启用|已启用|下降|终结点进行监控，并不正常。|
|已启用|已启用|CheckingEndpoint|终结点进行监控，但尚未收到的第一个探测器的结果。 刚到配置文件中，添加新的终结点或只启用了配置文件或终结点时，这种状态是暂时的。|
|已启用|已启用|已停止|未运行的基本的云服务或网站。|

### 配置文件监视器状态

下表中的配置文件监视器状态是组合的终结点监视状态和配置的配置文件状态的结果。

|配置文件状态 （按配置）|终结点监视状态|配置文件监视器状态 （API 和门户网站）|注释|
|---|---|---|---|
|禁用|&lt;任何&gt;或与任何已定义的终结点配置文件。|禁用|不监视的终结点。|
|已启用|至少一个终结点的状态为"降级。"|下降|这是一个标志，该标志不需要客户操作。|
|已启用|至少一个终结点的状态为"联机"。 没有终结点是"下降。"|联机|服务正在接收通信，不需要客户操作。|
|已启用|至少一个终结点的状态为"CheckingEndpoint"。 没有终结点是"联机"降级"。|CheckingEndpoints|过渡状态。 这通常发生在只启用了配置文件和所探测的终结点运行状况。|
|已启用|在配置文件中定义的所有端点的状态是"已禁用"停止"，或配置文件有没有已定义的终结点。|处于非活动状态|没有终结点处于活动状态，但仍然启用了配置文件。|

## 监视的工作方式

阐释与一个云服务监视进程的示例时间线显示的是下面。 这种情况下显示以下信息︰

- 云服务是通过仅此流量管理器配置文件的提供和接收通信。

- 云服务将不可用。

- 云服务不可超过 DNS 的生存时间 (TTL) 很多时间。

- 云服务将再次变为可用。

- 云服务继续接收通信量通过仅此流量管理器配置文件。

![通信管理器监视序列](./media/traffic-manager-monitoring/IC697947.jpg)

**图 1** – 监视序列示例。 在图表中的数字对应于以下编号的解释。

1. **获取**流量管理器监视系统上的路径和您在监视设置中指定的文件执行 GET。
2. **200 确定**– 监视系统在 10 秒钟内回期望 HTTP 200 OK 消息。 当它收到此响应时，它假定云服务可用。 

>[AZURE.NOTE] 通信管理器仅考虑终结点返回的消息是 200 确定可联机。 如果收到非 200 响应时，它将采用端点不可用，将计算这作为失败的检查。 有关故障排除的故障检查的更多详细信息请参阅[疑难解答降级状态 Azure 流量管理器上](traffic-manager-troubleshooting-degraded.md)。

3. **之间的 30 秒检查**– 每隔 30 秒将执行此项检查。
4. **云服务不可用**--云服务将不可用。 通信管理器不会知道直到下一次的监视检查。
5. **尝试访问监视文件 （4 次尝试）** – 监视系统执行 GET，但是没有收到响应，10 秒或更少。 然后，执行在 30 秒的间隔三个更多的尝试。 这意味着，顶多花费的监控系统来检测服务不可用时约为 1.5 分钟。 如果其中一个尝试成功，然后尝试次数将被重置。 尽管不图所示，如果 200 OK 消息回来后获得超过 10 秒钟，监视系统仍数将此作为失败的检查。
6. **已标记降级**– 后在行上，第四次故障监视系统将标记不可用的云服务性能下降。 

7. **为云服务的通信量便会减少**--通信可能继续流向不可用的云服务。 因为此服务不可用，客户端会遇到故障。 客户端和辅 DNS 服务器都缓存不可用的云服务的 IP 地址的 DNS 记录。 他们继续在公司域的 DNS 名称解析为 IP 地址的服务。 此外，辅 DNS 服务器可能仍然传达 DNS 信息的服务不可用。 为客户端和辅 DNS 服务器进行更新，将会降低到服务不可用的 IP 地址的通信。 监视系统仍然无法在 30 秒的间隔执行检查。 在此示例中，该服务没有响应，仍不可用。
8. **为云服务的通信流停止**– 这一次，大多数 DNS 服务器和客户端应该更新，并对不可用的服务的通信流停止。 通信完全停止之前的最长时间是依存于 TTL 时间。 默认 DNS TTL 是 300 秒 （5 分钟）。 使用此值，客户端停止 5 分钟后使用该服务。 监视系统仍然无法在 30 秒的间隔执行检查和云服务没有响应。
9. **云服务回到联机状态和接收通信**– 服务变为可用，但流量管理器不知道直到监视系统执行检查。
10. **恢复服务的通信**的流量管理器获取收发 200 在 10 秒以内的确定。 然后它开始分发云服务的 DNS 名称的 DNS 服务器，它们要求更新。 因此，通信开始再次流动服务。

## 对于嵌套配置文件的子和父终结点状态

下表描述子和父配置文件的一个嵌套的配置文件，并将 minChildEndpoints 设置为监视流量管理器的行为。 有关详细信息，请参阅[流量管理器是什么？](traffic-manager-overview.md)。

|子配置文件监视器状态|父终结点监视状态|注释|
|---|---|---|
|DisabledThis 是由于被禁用您的配置文件。|已停止|停止的父终结点状态，未被禁用。 禁用状态被保留的该值指示禁用父配置文件中的终结点。|
|DegradedAt 至少其中一个是子终结点处于已降级状态。|在线状态，如果在线在子配置文件中的终结点的数量至少为 minChildEndpoints.CheckingEndpoint 状态的值如果联机加上 CheckingEndpoint 在子配置文件中的终结点的数量至少是 minChildEndpoints.Otherwise，处于降级状态的值。|通信将被路由到终结点的状态 CheckingEndpoint.If minChildEndpoints 设置得太高，父终结点始终会降级。|
|OnlineAt 至少有一个子是在线状态，都是处于已降级状态。|与上面的相同。||
|CheckingEndpointsAt 至少其中一个是 CheckingEndpoint;没有联机或降级|与上面的相同。||
|InactiveAll 终结点是禁用或已停止，或者这是终结点的配置文件|已停止||

## 若要配置监视特定的路径和文件名称

1. 使用相同的名称，您打算在您的配置文件中包含的每个端点上创建一个文件。
2. 对于每个终结点，使用 web 浏览器来测试对文件的访问。 URL 包含特定终结点 （云服务或网站） 时，将域名文件和文件的名称的路径。 
3. 管理门户下**监视设置**，请在**相对路径和文件名称**字段, 中指定的路径和文件名称。
4. 完成配置更改后，单击页面底部的**保存**。

## 请参见

[通信管理器是什么？](traffic-manager-overview.md)

[有关通信量管理器通信路由方法](traffic-manager-load-balancing-methods.md)

[云服务](http://go.microsoft.com/fwlink/p/?LinkId=314074)

[网站](http://go.microsoft.com/fwlink/p/?LinkId=393327)

[故障诊断已降级状态在 Azure 流量管理器](traffic-manager-troubleshooting-degraded.md)
 