---
ms.openlocfilehash: c90ef234cb97d1f350337d363237b10fd3a1ddc2
ms.sourcegitcommit: bab1265d669c3e6871daa7cb8a5640a47104947a
translationtype: MT
---
<properties 
   pageTitle="SQL azure 数据库索引顾问" 
   description="索引建议是提供程序可以轻松地创建索引，非常适合于运行现有的 Azure SQL 数据库的工作负荷。" 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="06/30/2015"
   ms.author="sstein"/>

# SQL 数据库索引顾问

Azure SQL 数据库索引顾问建议对现有的 SQL 数据库，可改善当前查询性能新的索引。

SQL 数据库服务评估通过分析历史资源使用的 SQL 数据库的索引性能，非常适合于运行数据库的典型工作负荷的索引建议。

索引顾问轻松索引管理通过提供创建的索引的建议。 V12 服务器索引顾问还可以创建并验证只需几次单击[Azure 门户](https://portal.azure.com/)中的索引。 创建索引后，SQL 数据库服务分析数据库工作负载的性能，并提供详细信息的新索引的影响。 如果分析认为推荐的索引对性能造成负面影响，则索引将自动还原。

索引顾问可以花较少时间来优化数据库性能。


> [AZURE.NOTE] 索引顾问目前正在预览并才[Azure 门户](https://portal.azure.com/)中可用。


## 预览的注意事项

索引顾问目前正在预览，并有以下限制︰

- 索引建议可以自动创建和验证的 V12 服务器只 （建议和索引创建的 V12 服务器提供了脚本）。
- 对于非聚集索引有建议和管理。

## 先决条件

若要查看和创建索引建议，需要在 Azure 中的正确的[基于角色的访问控制](role-based-access-control-configure.md)权限。 

- **读取器**，不需要以查看建议**SQL 数据库投稿人**权限。
- **所有者**，不需要执行任何操作; **SQL 数据库参与者**权限创建或删除索引，然后取消创建索引。


## 使用索引顾问

索引顾问是易于使用。 为了简化您的数据库的索引管理，请遵循以下准则︰

- 首先检查列表中的索引建议并决定创建或忽略哪些索引。 建议的列表进行排序和用其估计的性能的影响 （在下面详细说明）。 
- 创建或忽略建议的索引。 通过单击在门户中，**创建索引**自动创建索引或手动运行索引创建脚本来创建索引。
- 对于手动创建索引，应该连续监视创建过程和测量性能的影响。 对于自动创建的索引，SQL Azure 数据库服务自动执行监视和性能的影响分析。 



## 审查建议索引

索引顾问在[Azure 门户](https://portal.azure.com/)数据库刀片式服务器提供索引建议的列表。 顶部的所选的建议显示所选数据库中每个表在其中创建新索引可能会提高性能。

### 若要查看当前可用的索引建议︰

1. 登录到[Azure 的门户](https://portal.azure.com/)。
2. 在左侧的菜单中，单击**浏览**。
3. 单击**浏览**刀片式服务器中的**SQL 数据库**。
4. **SQL 数据库**刀片式服务器，请单击您想要查看推荐的索引数据库。
5. 单击以打开并查看所选数据库的可用**索引建议****索引顾问**。

> [AZURE.NOTE] 获取数据库的索引建议需要大约一周的使用情况，并在该周内需要有一些活动。 此外需要有一些一致的活动。 索引顾问可以更轻松地一致的查询模式进行优化比它的随机不突发的活动。

![[推荐索引][3]

建议按以下 4 类别的性能对其潜在影响︰

| 影响 | 说明 |
| :--- | :--- |
| High | 高影响建议应提供最重要的性能影响。 |
| 大量 | 实质性影响的建议可显著提高性能。 |
| 适中 | 中等影响建议应改善性能，但不是显著。 |
| Low | 低影响的建议应提供更好的性能，比如果没有索引，但不是可能显著改进。 
使用影响标记用于创建新的索引确定的最佳候选工作负荷。

### 管理建议的索引列表

如果您推荐索引的列表包含您认为非常有用的索引，索引顾问可以放弃 （您可以添加如果需要放弃回**推荐索引**列表后面的索引） 的索引建议。

#### 放弃的索引建议

1. 在**推荐索引**的列表中选择索引。
1. 在刀片式服务器**索引的详细信息**，请单击**丢弃索引**。

#### 查看丢弃索引，并将它们添加到主列表

1. **索引建议**刀片上单击**视图丢弃索引建议**。
1. 选择要查看其详细信息的列表从丢弃的索引。
1. （可选） 单击**撤消放弃**该索引将重新添加到**索引建议**的主列表。



## 创建新索引

索引顾问为您提供了如何创建索引的完全控制。 每一项建议提供 T SQL 索引创建脚本，并可以查看实际数据库上采取任何行动前如何创建索引的详细信息。

索引建议适用于所有 SQL Azure 数据库服务器，但只有 V12 服务器提供了自动的索引的创建。 非 V12 服务器仍可以利用索引顾问，但是您必须手动创建索引，如下所述。

这两种自动和手动索引创建只需选择推荐的索引从**索引建议**刀片式服务器，请执行下列操作︰

### 创建自动索引 （仅 V12 服务器）

V12 服务器上数据库时您轻松选择所需的索引，在门户网站上，然后单击**创建索引**创建建议的索引。 

数据库保持联机索引创建，使用索引顾问创建索引期间不会不使数据库离线。

此外，与**创建索引**创建索引不需要任何进一步的性能监视。 如果索引对性能有负面影响，索引将自动还原。 使用创建索引之后, 新索引的影响的指标是在门户中可用。 


### 创建手动索引 （所有服务器）

在门户中选择任何建议的索引，然后单击**查看脚本**。 根据您创建建议的索引的数据库中运行此脚本。 手动创建的索引不是监视并因此我们建议您创建验证它们提高性能和调整或在必要时删除它们后监视这些索引验证实际性能的影响。 有关创建索引的详细信息，请参阅[创建索引 (事务处理 SQL)](https://msdn.microsoft.com/library/ms188783.aspx)。


### 取消创建索引

处于**挂起**状态的索引可被取消。 （**正在执行**状态） 创建的索引不能取消。

1. 选择区域中的**索引操作**来打开**索引详细信息**刀片式服务器**挂起**的任何索引。
1. 单击**取消**以中止在索引创建过程。

## 监视索引操作之后创建索引

创建索引不会发生在瞬间完成。 门户网站提供了有关索引操作的状态的详细信息。 管理索引会以下索引可以是中的可能的状态︰

| 。 | 说明 |
| :--- | :--- |
| 待定 | 创建索引命令已收到并且计划创建索引。 |
| 执行 | 运行创建索引命令，当前创建索引。 |
| 成功 | 已成功创建该索引。 |
| 失败 | 尚未创建索引。 这可能是暂时性问题，或可能是架构更改为表和脚本将不再有效。 |
| 还原 | 在索引创建过程已被取消或被认为是与性能无关，正在被自动还原。 |



![[推荐索引][4]



## 删除索引
您可以删除与索引顾问已创建的索引。


1. 选择列表中的**索引操作**将成功创建的索引。
1. 单击**删除索引****索引详细信息**刀片式服务器，或单击删除索引脚本**查看脚本**。



## 摘要

索引建议提供自动管理索引创建和分析每个 SQL 数据库和推荐最佳的索引体验。 单击以查看索引建议数据库刀片式服务器上的**索引顾问**平铺。



## 下一步行动

监视索引建议并继续应用它们来优化性能。 数据库工作负载是动态的不断更改。 索引顾问将继续监视，并可能会提高数据库的性能的索引建议。 


<!--Image references-->
[1]: ./media/sql-database-index-advisor/index-recommendations.png
[2]: ./media/sql-database-index-advisor/index-details.png
[3]: ./media/sql-database-index-advisor/recommended-indexes.png
[4]: ./media/sql-database-index-advisor/index-operations.png



